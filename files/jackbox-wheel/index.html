<!DOCTYPE html>
<html>

<head>
    <style>html {display: none;}</style>
    <title>Jackbox Wheel</title>
    <link rel="stylesheet" href="/styles.css">
    <link rel="stylesheet" href="./wheel.css">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <link rel="shortcut icon" href="/favicon.ico" >
    <link href="https://fonts.googleapis.com/css2?family=Asap" rel="stylesheet">
    <link href="/fontawesome/css/all.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,200;1,300;1,400;1,600;1,700&display=swap" rel="stylesheet">
</head>

<body id="body">
    <div class="navbar">
        <a href="/" class="name">Hooley McKnight</a>
        <div class="empty"></div>
        <div class="social-media">
            <a href="https://twitch.tv/hooleymcknight" target="_blank" class="twitch"><i class="fab fa-twitch"></i></a>
            <a href="https://instagram.com/hooleymcknight" target="_blank" class="instagram"><i class="fab fa-instagram"></i></a>
            <a href="https://youtube.com/c/hooleymcknight" target="_blank" class="youtube"><i class="fab fa-youtube"></i></a>
            <a href="https://twitter.com/hooleymcknight" target="_blank" class="twitter"><i class="fab fa-twitter"></i></a>
            <a href="https://discord.gg/8MYDjz5" target="_blank" class="discord"><i class="fab fa-discord"></i></a>
            <a href="https://open.spotify.com/user/qyo65dvm8jmh1ondfmx69pa0n?si=QuQbe8kKS1Kke2tRJk1auA" target="_blank" class="spotify"><i class="fab fa-spotify"></i></a>
        </div>
    </div>

    <main class="wheel">

        <div class="wheel-of-game">
            <div class="spinner">
              <span>Spin</span>
            </div>

            <div id="wheelContainer" style="transform: rotate(0deg);">
              <div class="game-slice" style="background-image: url('./jackbox-tiles/guesspionage.png');">
                <span class="game-title">Guesspionage</span>
              </div>

              <div class="game-slice" style="background-image: url('./jackbox-tiles/fakin-it.png');">
                <span class="game-title">Fakin' It</span>
              </div>

              <div class="game-slice" style="background-image: url('./jackbox-tiles/trivia-murder-party-2.png');">
                <span class="game-title">Trivia Murder Party 2</span>
              </div>

              <div class="game-slice" style="background-image: url('./jackbox-tiles/tee-ko.png');">
                <span class="game-title">Tee K.O.</span>
              </div>

              <div class="game-slice" style="background-image: url('./jackbox-tiles/quiplash-3.png');">
                <span class="game-title">Quiplash 3</span>
              </div>

              <div class="game-slice" style="background-image: url('./jackbox-tiles/survive-the-internet.png');">
                <span class="game-title">Survive the Internet</span>
              </div>

              <div class="game-slice" style="background-image: url('./jackbox-tiles/fibbage-3.png');">
                <span class="game-title">Fibbage 3: Enough About You</span>
              </div>

              <div class="game-slice" style="background-image: url('./jackbox-tiles/push-the-button.png');">
                <span class="game-title">Push the Button</span>
              </div>

              <div class="game-slice" style="background-image: url('./jackbox-tiles/the-devil-in-the-details.png');">
                <span class="game-title">The Devil in the Details</span>
              </div>

              <div class="game-slice" style="background-image: url('./jackbox-tiles/monster-seeking-monster.png');">
                <span class="game-title">Monster Seeking Monster</span>
              </div>

              <div class="game-slice" style="background-image: url('./jackbox-tiles/civic-doodle.png');">
                <span class="game-title">Civic Doodle</span>
              </div>

              <div class="game-slice" style="background-image: url('./jackbox-tiles/patently-stupid.png');">
                <span class="game-title">Patently Stupid</span>
              </div>

              <div class="game-slice" style="background-image: url('./jackbox-tiles/split-the-room.png');">
                <span class="game-title">Split the Room</span>
              </div>

              <div class="game-slice" style="background-image: url('./jackbox-tiles/mad-verse-city.png');">
                <span class="game-title">Mad Verse City</span>
              </div>

              <div class="game-slice" style="background-image: url('./jackbox-tiles/role-models.png');">
                <span class="game-title">Role Models</span>
              </div>

              <div class="game-slice" style="background-image: url('./jackbox-tiles/champd-up.png');">
                <span class="game-title">Champ'd Up</span>
              </div>

              <div class="game-slice" style="background-image: url('./jackbox-tiles/blather-round.png');">
                <span class="game-title">Blather Round</span>
              </div>

              <div class="game-slice" style="background-image: url('./jackbox-tiles/drawful-animate.png');">
                <span class="game-title">Drawful Animate</span>
              </div>

              <div class="game-slice" style="background-image: url('./jackbox-tiles/the-wheel-of-enormous-proportions.png');">
                <span class="game-title">The Wheel of Enormous Proportions</span>
              </div>

              <div class="game-slice" style="background-image: url('./jackbox-tiles/poll-mine.png');">
                <span class="game-title">Poll Mine</span>
              </div>

              <div class="game-slice" style="background-image: url('./jackbox-tiles/weapons-drawn.png');">
                <span class="game-title">Weapons Drawn</span>
              </div>
            </div>

        </div>

        <p class="winner-title"></p>

        <div id="theme-toggle" class="theme-toggle">
            <div class="toggle-switch"></div>
            <i class="fas fa-sun"></i>
            <i class="fas fa-moon"></i>
        </div>

    </main>

    <script type="text/javascript">
        const wheelContainer = document.querySelector('#wheelContainer')
        const sliceCount = $('.game-slice').length
        const halfSliceSize = (360 / sliceCount) / 2
        // set up the slices
        setUpSlices(wheelContainer, sliceCount, halfSliceSize)

        // if window is resized
        window.addEventListener('resize', function(e) {
          const thresholdWidths = [419, 420, 421, 766, 767, 768]
          if(thresholdWidths.includes(window.innerWidth)) {
            setUpSlices(wheelContainer, sliceCount, halfSliceSize)
          }
        })

        // if the spinner activates
        $('.spinner').on('click', (e) => {
          const spinner = e.target.closest('.spinner')
          if (spinner.classList.contains('spinning')) {
            return
          }

          // make the spinner unspinnable for now
          spinner.classList.add('spinning')
          spinner.innerText = 'Spinning'
          // return selected game (if any) to normal
          const winner = wheelContainer.querySelector('.winner')
          if (winner) {
            wheelContainer.classList.remove('winner')
            winner.classList.remove('winner')
            document.querySelector('.winner-title').innerText = ''
          }

          // spin the wheel!
          let origRot = wheelContainer.style.transform
          if (origRot.includes('rotate')) {
            origRot = Number(origRot.match(/(\d+)/)[0]) // the current degree of rotation if it exists
          }
          else {
            origRot = 0 // 0 is fallback
          }
          const spinRot = randomNumber(origRot + (360 * 3), (origRot + (360 * 8)))
          const origStyle = wheelContainer.getAttribute('style')
          wheelContainer.setAttribute('style', `${origStyle.replace(/(transform)(.*)(deg\);)/, `transform: rotate(${spinRot}deg);`)}`)

          // after 3 seconds, determine the winner
          setTimeout(function() {
            const currentRotation = Number(wheelContainer.style.transform.match(/(\d+)/)[0])
            // spin arrow points 45 degrees counterclockwise from point 0, so we use 270 as the actual start point
            let sliceDeg = 270 - (currentRotation % 360)
            if (sliceDeg < 0) {
              sliceDeg += 360
            }
            const sliceMin = sliceDeg - halfSliceSize
            const sliceMax = sliceDeg + halfSliceSize

            // find the slice
            Array.from(wheelContainer.querySelectorAll('.game-slice')).every((slice) => {
              const deg = Number(slice.getAttribute('sliceDegrees'))
              if (deg >= sliceMin && deg < sliceMax) {
                // declare a winner
                slice.classList.add('winner')
                wheelContainer.classList.add('winner')
                document.querySelector('.winner-title').innerText = slice.innerText

                // reset spinner
                spinner.innerText = 'Spin'
                spinner.classList.remove('spinning')

                // break
                return false
              }
              return true
            })
          }, 3200)
        })

        function randomNumber(min, max) {
          return Math.floor(Math.random() * (max - min + 1) + min)
        }

        function setUpSlices(wheelContainer, sliceCount, halfSliceSize) {
          const screenWidth = window.innerWidth

          let diameter = 700
          if (screenWidth < 767 && screenWidth > 420) {
            diameter = 400
          }
          else if(screenWidth <= 420) {
            diameter = 300
          }

          Array.from($('.game-slice')).forEach((slice, idx) => {
            const originalStyle = slice.getAttribute('style')
            const rotation = (360 / sliceCount) * idx
            const sliceHeight = (diameter * Math.PI) / sliceCount
            slice.setAttribute('style', `${originalStyle} --rotation: ${rotation}deg; --sliceHeight: ${sliceHeight}px;`)
            slice.setAttribute('sliceDegrees', rotation)
          })
        }
    </script>

    <script src="/app.js"></script>

</body>

</html>
